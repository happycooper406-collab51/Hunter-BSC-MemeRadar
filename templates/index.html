<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hunter - æ—©é³¥çµæ‰‹åˆ†æå¹³å°</title>
    
    <!-- Ethers.js for MetaMask integration -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #a855f7;
            --secondary: #d946ef;
            --accent: #c084fc;
            --bg-dark: #0f0a1e;
            --bg-darker: #080510;
            --surface: rgba(30, 20, 45, 0.8);
            --surface-light: rgba(40, 30, 55, 0.6);
            --text-primary: #ffffff;
            --text-secondary: #b4a7d6;
            --border: rgba(168, 85, 247, 0.15);
            --success: #a855f7;
            --warning: #fbbf24;
            --danger: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* å‹•æ…‹èƒŒæ™¯ */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }

        .grid-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(168, 85, 247, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(168, 85, 247, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .glow-orb {
            position: absolute;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: float 8s ease-in-out infinite;
        }

        .orb-1 {
            background: var(--primary);
            top: 10%;
            left: 10%;
        }

        .orb-2 {
            background: var(--secondary);
            bottom: 10%;
            right: 10%;
            animation-delay: -4s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, 30px); }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 60px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo::before {
            content: 'â—†';
            font-size: 1.2rem;
            -webkit-text-fill-color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .version-badge {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary);
        }

        .lang-toggle {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lang-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .help-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .help-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Help Modal */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 8, 16, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .help-modal.active {
            display: flex;
        }

        .help-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(168, 85, 247, 0.3);
        }

        .help-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--surface);
            z-index: 10;
        }

        .help-header h2 {
            margin: 0;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .help-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px 8px;
            transition: color 0.3s;
        }

        .help-close:hover {
            color: var(--primary);
        }

        .help-body {
            padding: 24px;
        }

        .help-step {
            margin-bottom: 24px;
        }

        .help-step h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .help-step p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }

        .help-tips {
            background: rgba(168, 85, 247, 0.05);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
        }

        .help-tips h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .help-tips ul {
            margin: 0;
            padding-left: 20px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .help-tips li {
            margin-bottom: 8px;
        }

        .donate-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-dark);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .donate-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        /* Hero Section */
        .hero {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
            min-height: calc(100vh - 200px);
        }

        .hero-left h1 {
            font-size: 3.5rem;
            line-height: 1.1;
            margin-bottom: 24px;
            font-weight: 700;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-left p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.6;
        }

        /* è¼¸å…¥è¡¨å–® */
        .input-section {
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-label .required {
            color: var(--danger);
        }

        input[type="text"],
        input[type="number"],
        input[type="password"] {
            width: 100%;
            background: rgba(10, 14, 23, 0.6);
            border: 1px solid var(--border);
            padding: 14px 16px;
            border-radius: 10px;
            font-size: 0.95rem;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.15);
        }

        input::placeholder {
            color: rgba(136, 146, 176, 0.5);
        }

        /* Tooltip æµ®çª— */
        .tooltip-wrapper {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: help;
            transition: all 0.3s;
        }

        .tooltip-icon:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: scale(1.1);
        }

        .tooltip-text {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        .tooltip-icon:hover .tooltip-text {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-4px);
        }

        .tooltip-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--border);
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .btn-analyze {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-dark);
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn-analyze::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s;
        }

        .btn-analyze:hover::before {
            left: 100%;
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(168, 85, 247, 0.4);
        }

        /* è¦–è¦ºåŒ–å€åŸŸ */
        .hero-right {
            position: relative;
            height: 500px;
        }

        .data-viz {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .viz-circle {
            position: absolute;
            border: 2px solid var(--primary);
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
        }

        .viz-circle-1 {
            width: 400px;
            height: 400px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-width: 3px;
        }

        .viz-circle-2 {
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -1s;
            border-width: 2px;
        }

        .viz-circle-3 {
            width: 200px;
            height: 200px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -2s;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.4;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        .data-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--primary), 0 0 40px rgba(168, 85, 247, 0.5);
            animation: orbit 10s linear infinite;
        }

        .data-point:nth-child(1) { top: 20%; left: 30%; }
        .data-point:nth-child(2) { top: 40%; right: 20%; animation-delay: -5s; }
        .data-point:nth-child(3) { bottom: 30%; left: 40%; animation-delay: -7s; }
        .data-point:nth-child(4) { top: 60%; right: 40%; animation-delay: -3s; }

        @keyframes orbit {
            0% { transform: translate(0, 0); }
            25% { transform: translate(20px, -20px); }
            50% { transform: translate(0, -40px); }
            75% { transform: translate(-20px, -20px); }
            100% { transform: translate(0, 0); }
        }

        /* Results Page */
        .results-page {
            display: none;
        }

        .results-page.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .back-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .token-badge {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 8px;
            font-family: monospace;
            color: var(--primary);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            padding: 28px;
            border-radius: 16px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Table */
        .table-section {
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .export-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .export-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(10, 14, 23, 0.4);
        }

        th {
            padding: 16px 32px;
            text-align: left;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
            transition: color 0.3s;
        }

        th:hover {
            color: var(--primary);
        }

        .sort-indicator {
            margin-left: 8px;
            opacity: 0.5;
            font-size: 0.8em;
        }

        .sort-indicator.active {
            opacity: 1;
            color: var(--primary);
        }

        td {
            padding: 18px 32px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: rgba(168, 85, 247, 0.08);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-dark);
            border-radius: 8px;
            font-weight: 700;
        }

        .address-cell {
            font-family: monospace;
            color: var(--secondary);
        }

        .profit-positive {
            color: var(--success);
            font-weight: 700;
        }

        .status-active {
            color: var(--success);
        }

        .status-bot {
            color: #9ca3af;
            opacity: 0.7;
            font-weight: 400;
        }

        .status-holding {
            color: #c084fc;
            font-weight: 500;
        }

        .status-sold {
            color: #a78bfa;
            font-weight: 500;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 8, 16, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 24px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Footer */
        .footer {
            margin-top: 80px;
            padding: 40px 0;
            border-top: 1px solid var(--border);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-social {
            display: flex;
            gap: 20px;
        }

        .social-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }

        .social-link:hover {
            color: var(--primary);
        }

        .footer-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .donate-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-end;
        }

        .donate-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .donate-address {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
            user-select: all;
        }

        .donate-address:hover {
            border-color: var(--primary);
            box-shadow: 0 0 12px rgba(168, 85, 247, 0.3);
        }

        /* Responsive */
        @media (max-width: 968px) {
            .hero {
                grid-template-columns: 1fr;
            }

            .hero-right {
                height: 300px;
            }

            .nav-links {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .hero-left h1 {
                font-size: 2.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 12px 16px;
                font-size: 0.85rem;
            }

            .footer-content {
                flex-direction: column;
                gap: 24px;
                text-align: center;
            }

            .donate-section {
                align-items: center;
            }

            .donate-address {
                font-size: 0.75rem;
                word-break: break-all;
            }
        }
        /* ==================== ä»˜è²»ç³»çµ±æ¨£å¼ ==================== */
        
        /* ä»˜è²»ç‹€æ…‹é¡¯ç¤º */
        .paid-status {
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid var(--primary);
            border-radius: 12px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .paid-badge {
            display: inline-flex;
            align-items: center;
            gap: 16px;
            font-size: 1.1rem;
            color: var(--primary);
            font-weight: 600;
        }

        .uses-left {
            padding: 4px 12px;
            background: rgba(168, 85, 247, 0.2);
            border-radius: 20px;
            font-size: 0.95rem;
        }

        .time-left {
            padding: 4px 12px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 20px;
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
        }

        /* ä»˜è²»æŒ‰éˆ•ï¼ˆç·Šæ¹Šç‰ˆï¼‰*/
        .pay-button-compact {
            padding: 0 16px;
            height: 48px;  /* èˆ‡è¼¸å…¥æ¡†åŒé«˜ */
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(168, 85, 247, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 110px;
        }

        .pay-button-compact small {
            font-size: 0.7rem;
            opacity: 0.85;
            font-weight: 400;
            margin-top: 2px;
        }

        .pay-button-compact::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .pay-button-compact:hover::before {
            left: 100%;
        }

        .pay-button-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.5);
        }

        .pay-button-compact:active {
            transform: translateY(0);
        }

        .pay-button-compact:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* API Key è¼¸å…¥çµ„ï¼ˆæ©«æ’å¸ƒå±€ï¼‰*/
        .api-key-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;  /* åº•éƒ¨å°é½Š */
        }

        .api-key-input-wrapper {
            flex: 1;
        }

        /* ç³»çµ±ç‹€æ…‹æ¬„ */
        .system-status-bar {
            margin-bottom: 20px;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.05));
            border-left: 3px solid var(--primary);
            border-radius: 8px;
            animation: fadeIn 0.3s ease;
        }

        .system-status-bar.warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border-left-color: var(--warning);
        }

        .system-status-bar.busy {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            border-left-color: var(--danger);
        }

        .status-content {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-icon {
            font-size: 1.2rem;
        }

        #statusText {
            font-weight: 500;
        }

        /* ä»˜è²»åŠŸèƒ½æç¤º */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- å‹•æ…‹èƒŒæ™¯ -->
    <div class="background">
        <div class="grid-pattern"></div>
        <div class="glow-orb orb-1"></div>
        <div class="glow-orb orb-2"></div>
    </div>

    <!-- Hero Page -->
    <div id="heroPage">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="logo">ä¼å£¹ 51</div>
                <div class="nav-links">
                    <a href="https://x.com/0x515151" target="_blank">ğŸ¦ Twitter</a>
                    <button class="donate-badge" onclick="copyDonateAddress()" data-i18n="donate">ğŸ’ æ‰“è³</button>
                    <button class="help-btn" onclick="toggleHelp()">â„¹ï¸ <span id="helpText">èªªæ˜</span></button>
                    <button class="lang-toggle" onclick="toggleLanguage()">ğŸŒ <span id="langText">EN</span></button>
                    <span class="version-badge">v2.1.1</span>
                </div>
            </div>

            <!-- Hero Section -->
            <div class="hero">
                <div class="hero-left">
                    <h1 id="heroTitle">
                        ç™¼ç¾<span class="gradient-text">æ—©é³¥çµæ‰‹</span><br>
                        æ‰¾å‡ºçœŸæ­£çš„ç²åˆ©è´å®¶
                    </h1>
                    <p id="heroSubtitle">
                        é€éå€å¡Šéˆæ•¸æ“šåˆ†æï¼Œè¿½è¹¤ä»£å¹£æ—©æœŸè²·å®¶çš„äº¤æ˜“è¡Œç‚ºï¼Œ<br>
                        ç²¾æº–è­˜åˆ¥ç²åˆ©æ©Ÿæœƒèˆ‡æ©Ÿå™¨äººæ¨¡å¼ã€‚
                    </p>

                    <!-- è¼¸å…¥è¡¨å–® -->
                    <div class="input-section">
                        <!-- ç³»çµ±ç‹€æ…‹é¡¯ç¤º -->
                        <div id="systemStatusBar" class="system-status-bar" style="display: none;">
                            <div class="status-content">
                                <span class="status-icon">ğŸ‘¥</span>
                                <span id="statusText">ç›®å‰ä½¿ç”¨äººæ•¸ï¼š0</span>
                            </div>
                        </div>
                        
                        <!-- API Key å’Œä»˜è²»æŒ‰éˆ•ï¼ˆæ©«æ’ï¼‰-->
                        <div class="api-key-row">
                            <div class="api-key-input-wrapper form-group">
                                <label class="form-label tooltip-wrapper">
                                    <span id="labelApiKey">Etherscan V2 API Key</span> <span class="required">*</span>
                                    <span class="tooltip-icon">
                                        ?
                                        <span class="tooltip-text" id="tooltipApiKey">Etherscanå·²å…¨é¢æ›´æ–°ç‚ºä»˜è²» V2 APIï¼Œå…è²»ç‰ˆç„¡æ³•ä½¿ç”¨</span>
                                    </span>
                                </label>
                                <input type="password" id="apiKey" placeholder="è¼¸å…¥ä½ çš„ Etherscan V2 API Key" />
                            </div>
                            
                            <button type="button" id="payButton" class="pay-button-compact" onclick="payForService()">
                                ğŸ’° ä»˜è²» API
                                <small>0.01 BNB</small>
                            </button>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <span id="labelTokenAddress">ä»£å¹£åˆç´„åœ°å€</span> <span class="required">*</span>
                            </label>
                            <input type="text" id="tokenAddress" placeholder="0x..." />
                        </div>

                        <div class="time-inputs">
                            <div class="form-group">
                                <label class="form-label tooltip-wrapper">
                                    <span id="labelStartTime">èµ·å§‹æ™‚é–“</span>
                                    <span class="tooltip-icon">
                                        ?
                                        <span class="tooltip-text" id="tooltipStartTime">å¾é–‹ç›¤å¾Œå¤šä¹…é–‹å§‹æŠ“å–<br>ä¾‹ï¼š15åˆ†é˜ = å¾é–‹ç›¤å¾Œ15åˆ†é˜é–‹å§‹</span>
                                    </span>
                                </label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                    <div>
                                        <input type="number" id="startMinutes" value="0" placeholder="0" />
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 4px;" id="unitMinutes1">åˆ†é˜</div>
                                    </div>
                                    <div>
                                        <input type="number" id="startSeconds" value="0" placeholder="0" />
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 4px;" id="unitSeconds1">ç§’</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label tooltip-wrapper">
                                    <span id="labelEndTime">çµæŸæ™‚é–“ï¼ˆé–‹ç›¤å¾Œï¼‰</span>
                                    <span class="tooltip-icon">
                                        ?
                                        <span class="tooltip-text" id="tooltipEndTime">åˆ°é–‹ç›¤å¾Œå¤šä¹…çµæŸæŠ“å–<br>ä¾‹ï¼š30åˆ†é˜ = åˆ°é–‹ç›¤å¾Œ30åˆ†é˜ç‚ºæ­¢</span>
                                    </span>
                                </label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                    <div>
                                        <input type="number" id="endMinutes" value="1" placeholder="1" />
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 4px;" id="unitMinutes2">åˆ†é˜</div>
                                    </div>
                                    <div>
                                        <input type="number" id="endSeconds" value="0" placeholder="0" />
                                        <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 4px;" id="unitSeconds2">ç§’</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label tooltip-wrapper">
                                <span id="labelBotThreshold">æ©Ÿå™¨äººé–¾å€¼</span>
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text" id="tooltipBotThreshold">ç¯©é¸é«˜é »äº¤æ˜“å¸³è™Ÿ<br>äº¤æ˜“ç­†æ•¸ > æ­¤å€¼ = æ©Ÿå™¨äºº<br>å»ºè­°ï¼š10ï¼ˆåš´æ ¼ï¼‰~ 100ï¼ˆå¯¬é¬†ï¼‰</span>
                                </span>
                            </label>
                            <input type="number" id="maxTxs" value="10" placeholder="10" />
                        </div>

                        <button class="btn-analyze" onclick="startAnalysis()" id="btnAnalyze">
                            ğŸš€ é–‹å§‹åˆ†æ
                        </button>
                    </div>
                </div>

                <div class="hero-right">
                    <div class="data-viz">
                        <div class="viz-circle viz-circle-1"></div>
                        <div class="viz-circle viz-circle-2"></div>
                        <div class="viz-circle viz-circle-3"></div>
                        <div class="data-point"></div>
                        <div class="data-point"></div>
                        <div class="data-point"></div>
                        <div class="data-point"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div class="results-page" id="resultsPage">
        <div class="container">
            <div class="results-header">
                <button class="back-btn" onclick="backToHome()">
                    â† è¿”å›
                </button>
                <div class="token-badge" id="tokenInfo">Token: â€”</div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-value" id="totalTx">â€”</div>
                    <div class="stat-label">ç¸½äº¤æ˜“æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-value" id="maxProfit">â€”</div>
                    <div class="stat-label">æœ€é«˜åˆ©æ½¤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ¤–</div>
                    <div class="stat-value" id="robots">â€”</div>
                    <div class="stat-label">æ©Ÿå™¨äºº</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-value" id="timeRange">â€”</div>
                    <div class="stat-label">å€é–“</div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-section">
                <div class="table-header">
                    <div>
                        <h2>æ—©æœŸè²·å®¶æ’è¡Œæ¦œ</h2>
                        <div id="tokenName" style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 8px;"></div>
                    </div>
                    <button class="export-btn" onclick="exportCSV()">ğŸ“¥ åŒ¯å‡º CSV</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th id="th-rank">#</th>
                            <th id="th-address" onclick="sortTable('address')"><span class="sort-indicator" id="sort-address"></span></th>
                            <th id="th-bnb" onclick="sortTable('bnb')"><span class="sort-indicator" id="sort-bnb"></span></th>
                            <th id="th-usd" onclick="sortTable('usd')"><span class="sort-indicator" id="sort-usd"></span></th>
                            <th id="th-multiple" onclick="sortTable('multiple')"><span class="sort-indicator" id="sort-multiple"></span></th>
                            <th id="th-status"></th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="footer-content">
                    <div class="footer-social">
                        <a href="https://x.com/0x515151" target="_blank" class="social-link">ğŸ¦ Twitter</a>
                        <a href="#" class="social-link">ğŸ“„ Docs</a>
                        <a href="#" class="social-link">v2.1.0</a>
                    </div>
                    
                    <div class="footer-info">
                        ä¼å£¹ 51 è£½ä½œ
                    </div>

                    <div class="donate-section">
                        <div class="donate-label">ğŸ’ æ‰“è³åœ°å€</div>
                        <div class="donate-address" onclick="copyDonateAddress()" title="é»æ“Šè¤‡è£½">
                            0xe0b7e35556731872B3CE18c9645D69290F428C1C
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <!-- Loading with Progress -->
    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">æ­£åœ¨åˆ†æä¸­...</div>
        
        <!-- é€²åº¦é¡¯ç¤º -->
        <div style="margin-top: 30px; text-align: center; max-width: 500px;">
            <div style="background: rgba(30, 20, 45, 0.8); border: 1px solid rgba(168, 85, 247, 0.15); border-radius: 12px; padding: 20px;">
                <div id="progressStage" style="color: var(--primary); font-size: 1.1rem; margin-bottom: 12px;">åˆå§‹åŒ–...</div>
                <div id="progressMessage" style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">æº–å‚™ä¸­...</div>
                
                <!-- é€²åº¦æ¢ -->
                <div style="background: rgba(10, 14, 23, 0.6); border-radius: 8px; height: 8px; overflow: hidden; margin-bottom: 8px;">
                    <div id="progressBarFill" style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-tertiary);">
                    <span id="progressPercent">0%</span>
                    <span id="progressDetail"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨èªªæ˜å½ˆçª— -->
    <div class="help-modal" id="helpModal" onclick="closeHelpOnOutside(event)">
        <div class="help-content" onclick="event.stopPropagation()">
            <div class="help-header">
                <h2 id="helpTitle">ğŸ“– ä½¿ç”¨èªªæ˜</h2>
                <button class="help-close" onclick="toggleHelp()">âœ•</button>
            </div>
            <div class="help-body">
                <div class="help-step">
                    <h3 id="helpStep1Title">1ï¸âƒ£ æº–å‚™ API Key</h3>
                    <p id="helpStep1Text">åœ¨ Etherscan è¨»å†Šä¸¦ç²å– Etherscan V2 API</p>
                </div>
                <div class="help-step">
                    <h3 id="helpStep2Title">2ï¸âƒ£ è¼¸å…¥ä»£å¹£åœ°å€</h3>
                    <p id="helpStep2Text">è²¼ä¸Šè¦åˆ†æçš„ BSC ä»£å¹£åˆç´„åœ°å€<br>ï¼ˆç¾å·²æ”¯æŒ Four.meme & Flapï¼‰</p>
                </div>
                <div class="help-step">
                    <h3 id="helpStep3Title">3ï¸âƒ£ è¨­å®šæ™‚é–“å€é–“</h3>
                    <p id="helpStep3Text">é¸æ“‡å¾é–‹ç›¤å¾Œå¤šä¹…é–‹å§‹/çµæŸåˆ†æ<br>ä¾‹ï¼š0-60ç§’ = åˆ†æé–‹ç›¤å¾Œç¬¬ä¸€åˆ†é˜çš„è²·å®¶</p>
                </div>
                <div class="help-step">
                    <h3 id="helpStep4Title">4ï¸âƒ£ è¨­å®šæ©Ÿå™¨äººé–¾å€¼</h3>
                    <p id="helpStep4Text">äº¤æ˜“ç­†æ•¸è¶…éæ­¤å€¼è¦–ç‚ºæ©Ÿå™¨äºº<br>å»ºè­°ï¼š10ï¼ˆåš´æ ¼ï¼‰~ 100ï¼ˆå¯¬é¬†ï¼‰</p>
                </div>
                <div class="help-step">
                    <h3 id="helpStep5Title">5ï¸âƒ£ é–‹å§‹åˆ†æ</h3>
                    <p id="helpStep5Text">é»æ“ŠæŒ‰éˆ•ï¼Œç­‰å¾… 1-10 åˆ†é˜<br>æŸ¥çœ‹æ—©æœŸè²·å®¶çš„åˆ©æ½¤è¡¨ç¾</p>
                </div>
                <div class="help-tips">
                    <h3 id="helpTipsTitle">ğŸ’¡ æç¤º</h3>
                    <ul>
                        <li id="helpTip1">èšç„¦é–‹ç›¤å‰ 1-5 åˆ†é˜æ•ˆæœæœ€å¥½</li>
                        <li id="helpTip2">åˆ©æ½¤å€æ•¸é«˜çš„éæ©Ÿå™¨äººå¸³è™Ÿå€¼å¾—é—œæ³¨</li>
                        <li id="helpTip3">å¯åŒ¯å‡º CSV é€²è¡Œé€²ä¸€æ­¥åˆ†æ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ä»˜è²»ç³»çµ± ====================
        
        const PAYMENT_CONFIG = {
            receiver: '0xe0b7e35556731872B3CE18c9645D69290F428C1C',
            amount: '0.005',  // BNB
            chainId: '0x38'  // BSC Mainnet
        };

        let paymentToken = null;
        let tokenExpiry = null;
        let usesLeft = null;

        // é é¢åŠ è¼‰æ™‚æª¢æŸ¥ä»˜è²»ç‹€æ…‹
        window.addEventListener('load', () => {
            checkPaymentStatus();
        });

        function checkPaymentStatus() {
            const savedToken = localStorage.getItem('payment_token');
            const savedExpiry = localStorage.getItem('token_expiry');
            
            if (savedToken && savedExpiry) {
                const expiry = parseInt(savedExpiry);
                if (Date.now() / 1000 < expiry) {
                    // å‘å¾Œç«¯é©—è­‰
                    fetch('/api/check-payment-token', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({token: savedToken})
                    })
                    .then(r => r.json())
                    .then(data => {
                        if (data.valid) {
                            paymentToken = savedToken;
                            usesLeft = data.uses_left;
                            tokenExpiry = expiry;
                            showPaidUserUI(data.uses_left, data.time_left_minutes);
                        } else {
                            clearPaymentData();
                        }
                    })
                    .catch(() => clearPaymentData());
                } else {
                    clearPaymentData();
                }
            }
        }

        function clearPaymentData() {
            localStorage.removeItem('payment_token');
            localStorage.removeItem('token_expiry');
            localStorage.removeItem('uses_left');
            paymentToken = null;
            usesLeft = null;
            tokenExpiry = null;
            showFreeUserUI();
        }

        function showPaidUserUI(uses, minutes) {
            // éš±è—æ•´å€‹ API Key è¡Œï¼ˆåŒ…å«æŒ‰éˆ•ï¼‰
            const apiKeyRow = document.querySelector('.api-key-row');
            if (apiKeyRow) apiKeyRow.style.display = 'none';
            
            // å‰µå»ºæˆ–æ›´æ–°ä»˜è²»ç‹€æ…‹é¡¯ç¤º
            let statusDiv = document.getElementById('paidStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'paidStatus';
                statusDiv.className = 'paid-status';
                
                const inputSection = document.querySelector('.input-section');
                if (inputSection && inputSection.firstChild) {
                    inputSection.insertBefore(statusDiv, inputSection.firstChild);
                }
            }
            
            statusDiv.innerHTML = `
                <div class="paid-badge">
                    âœ¨ ä»˜è²»ç”¨æˆ¶
                    <span class="uses-left">${uses} æ¬¡å‰©é¤˜</span>
                    <span class="time-left">${minutes}:00</span>
                </div>
            `;
            statusDiv.style.display = 'block';
            
            // å•Ÿå‹•å€’è¨ˆæ™‚
            startCountdown();
        }

        function showFreeUserUI() {
            const apiKeyRow = document.querySelector('.api-key-row');
            const statusDiv = document.getElementById('paidStatus');
            
            if (apiKeyRow) apiKeyRow.style.display = 'flex';
            if (statusDiv) statusDiv.style.display = 'none';
        }

        let countdownInterval = null;

        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                if (!tokenExpiry) {
                    clearInterval(countdownInterval);
                    return;
                }
                
                const now = Date.now() / 1000;
                const left = Math.max(0, tokenExpiry - now);
                
                if (left <= 0) {
                    clearInterval(countdownInterval);
                    clearPaymentData();
                    alert('ä»˜è²»æ†‘è­‰å·²éæœŸ');
                    return;
                }
                
                const minutes = Math.floor(left / 60);
                const seconds = Math.floor(left % 60);
                
                const timeSpan = document.querySelector('.time-left');
                if (timeSpan) {
                    timeSpan.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('è«‹å®‰è£ MetaMask éŒ¢åŒ…ï¼\n\nè«‹å‰å¾€ https://metamask.io ä¸‹è¼‰');
                return null;
            }
            
            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{chainId: PAYMENT_CONFIG.chainId}]
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: PAYMENT_CONFIG.chainId,
                                chainName: 'Binance Smart Chain',
                                nativeCurrency: {
                                    name: 'BNB',
                                    symbol: 'BNB',
                                    decimals: 18
                                },
                                rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                blockExplorerUrls: ['https://bscscan.com/']
                            }]
                        });
                    } else {
                        throw switchError;
                    }
                }
                
                return accounts[0];
            } catch (error) {
                console.error('é€£æ¥éŒ¢åŒ…å¤±æ•—:', error);
                alert('é€£æ¥éŒ¢åŒ…å¤±æ•—: ' + error.message);
                return null;
            }
        }

        async function payForService() {
            const payButton = document.getElementById('payButton');
            const originalText = payButton.innerHTML;
            
            try {
                payButton.innerHTML = '<span>ğŸ”„ é€£æ¥éŒ¢åŒ…...</span>';
                payButton.disabled = true;
                
                const account = await connectWallet();
                if (!account) {
                    return;
                }
                
                payButton.innerHTML = '<span>ğŸ”„ è«‹åœ¨ MetaMask ç¢ºèªæ”¯ä»˜...</span>';
                
                const transactionParameters = {
                    from: account,
                    to: PAYMENT_CONFIG.receiver,
                    value: '0x' + (parseFloat(PAYMENT_CONFIG.amount) * 1e18).toString(16),
                    chainId: PAYMENT_CONFIG.chainId
                };
                
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters]
                });
                
                console.log('äº¤æ˜“å·²ç™¼é€:', txHash);
                
                payButton.innerHTML = '<span>â³ ç­‰å¾…äº¤æ˜“ç¢ºèªï¼ˆç´„ 3-5 ç§’ï¼‰...</span>';
                
                let confirmed = false;
                let attempts = 0;
                const maxAttempts = 60;
                
                while (!confirmed && attempts < maxAttempts) {
                    try {
                        const receipt = await window.ethereum.request({
                            method: 'eth_getTransactionReceipt',
                            params: [txHash]
                        });
                        
                        if (receipt && receipt.status === '0x1') {
                            confirmed = true;
                            break;
                        }
                    } catch (e) {
                        // ç¹¼çºŒç­‰å¾…
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    attempts++;
                }
                
                if (!confirmed) {
                    throw new Error('äº¤æ˜“ç¢ºèªè¶…æ™‚ï¼Œè«‹ç¨å¾Œæ‰‹å‹•é©—è­‰');
                }
                
                payButton.innerHTML = '<span>ğŸ”„ é©—è­‰æ”¯ä»˜...</span>';
                
                const response = await fetch('/api/verify-payment', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({tx_hash: txHash})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    paymentToken = data.token;
                    tokenExpiry = Date.now() / 1000 + data.expiry_seconds;
                    usesLeft = data.uses_left;
                    
                    localStorage.setItem('payment_token', paymentToken);
                    localStorage.setItem('token_expiry', tokenExpiry.toString());
                    localStorage.setItem('uses_left', usesLeft.toString());
                    
                    alert(`âœ… æ”¯ä»˜æˆåŠŸï¼\n\næ‚¨å·²ç²å¾— ${data.uses_left} æ¬¡ä½¿ç”¨æ¬Šé™\næœ‰æ•ˆæœŸï¼š${Math.floor(data.expiry_seconds / 60)} åˆ†é˜`);
                    
                    showPaidUserUI(data.uses_left, Math.floor(data.expiry_seconds / 60));
                } else {
                    throw new Error(data.error || 'é©—è­‰å¤±æ•—');
                }
                
            } catch (error) {
                console.error('æ”¯ä»˜å¤±æ•—:', error);
                alert('æ”¯ä»˜å¤±æ•—: ' + error.message);
            } finally {
                payButton.innerHTML = originalText;
                payButton.disabled = false;
            }
        }

        // ==================== ç³»çµ±ç‹€æ…‹é¡¯ç¤º ====================
        
        function updateSystemStatus() {
            fetch('/api/system-status')
                .then(r => r.json())
                .then(data => {
                    const statusBar = document.getElementById('systemStatusBar');
                    const statusText = document.getElementById('statusText');
                    
                    if (!statusBar || !statusText) return;
                    
                    const totalUsers = data.total_users || 0;
                    const activeCount = data.active_count || 0;
                    const queueCount = data.queue_count || 0;
                    
                    // ç§»é™¤æ‰€æœ‰ç‹€æ…‹é¡
                    statusBar.classList.remove('warning', 'busy');
                    
                    if (totalUsers === 0) {
                        // ç„¡äººä½¿ç”¨ï¼Œéš±è—ç‹€æ…‹æ¬„
                        statusBar.style.display = 'none';
                    } else {
                        // æœ‰äººä½¿ç”¨ï¼Œé¡¯ç¤ºç‹€æ…‹æ¬„
                        statusBar.style.display = 'block';
                        
                        if (data.is_busy && queueCount > 0) {
                            // ç¹å¿™ä¸”æœ‰æ’éšŠ
                            statusBar.classList.add('busy');
                            statusText.innerHTML = `âš ï¸ ç›®å‰ä½¿ç”¨äººæ•¸ï¼š<strong>${totalUsers}</strong> äººï¼ˆ${activeCount} è™•ç†ä¸­ + ${queueCount} æ’éšŠä¸­ï¼‰`;
                        } else if (data.is_busy) {
                            // ç¹å¿™ä½†ç„¡æ’éšŠ
                            statusBar.classList.add('warning');
                            statusText.innerHTML = `ğŸ”¥ ç›®å‰ä½¿ç”¨äººæ•¸ï¼š<strong>${totalUsers}</strong> äººï¼ˆæ»¿è¼‰é‹è¡Œä¸­ï¼‰`;
                        } else {
                            // æ­£å¸¸é‹è¡Œ
                            statusText.innerHTML = `ğŸ‘¥ ç›®å‰ä½¿ç”¨äººæ•¸ï¼š<strong>${totalUsers}</strong> äºº`;
                        }
                    }
                })
                .catch(err => {
                    console.error('ç„¡æ³•ç²å–ç³»çµ±ç‹€æ…‹:', err);
                });
        }
        
        // é é¢è¼‰å…¥æ™‚æ›´æ–°ä¸€æ¬¡
        updateSystemStatus();
        
        // æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡ç³»çµ±ç‹€æ…‹
        setInterval(updateSystemStatus, 5000);

        // ==================== åŸæœ‰åŠŸèƒ½ ====================
        function startAnalysis() {
            const apiKey = document.getElementById('apiKey').value;
            const address = document.getElementById('tokenAddress').value;
            const startMinutes = parseInt(document.getElementById('startMinutes').value) || 0;
            const startSeconds = parseInt(document.getElementById('startSeconds').value) || 0;
            const endMinutes = parseInt(document.getElementById('endMinutes').value) || 0;
            const endSeconds = parseInt(document.getElementById('endSeconds').value) || 0;
            const maxTxs = parseInt(document.getElementById('maxTxs').value) || 10;

            // æª¢æŸ¥æ˜¯å¦ç‚ºä»˜è²»ç”¨æˆ¶
            const isPaid = !!paymentToken;
            
            // é©—è­‰è¼¸å…¥
            if (!isPaid && !apiKey) {
                alert('è«‹å¡«å¯« API Key æˆ–ä½¿ç”¨ä»˜è²»æœå‹™');
                return;
            }
            
            if (!address) {
                alert('è«‹å¡«å¯«ä»£å¹£åœ°å€');
                return;
            }

            // è¨ˆç®—ç¸½ç§’æ•¸
            const startTime = startMinutes * 60 + startSeconds;
            const endTime = endMinutes * 60 + endSeconds;

            if (endTime <= startTime) {
                alert('çµæŸæ™‚é–“å¿…é ˆå¤§æ–¼èµ·å§‹æ™‚é–“');
                return;
            }

            // æª¢æŸ¥æŸ¥è©¢å€é–“æ˜¯å¦è¶…é 5 åˆ†é˜
            const queryDuration = endTime - startTime;
            if (queryDuration > 300) {
                alert(`âŒ æŸ¥è©¢å€é–“éé•·ï¼\n\næœ€å¤š 5 åˆ†é˜ï¼ˆ300 ç§’ï¼‰\næ‚¨çš„è¨­å®šç‚º ${queryDuration} ç§’ï¼ˆ${Math.floor(queryDuration/60)} åˆ† ${queryDuration%60} ç§’ï¼‰\n\nè«‹ç¸®çŸ­æŸ¥è©¢å€é–“ä»¥é¿å…ç³»çµ±å¡è»Š`);
                return;
            }

            console.log('ğŸš€ é–‹å§‹åˆ†æ:', {
                tokenAddress: address,
                startTime,
                endTime,
                queryDuration,
                maxTxs,
                isPaid: isPaid
            });

            // é¡¯ç¤º loading
            document.getElementById('loading').classList.add('active');
            updateProgressUI(0, 'åˆå§‹åŒ–', 'æ­£åœ¨é€£æ¥ API...');

            // å‘¼å«ç•°æ­¥ API
            fetch('/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    is_paid: isPaid,
                    payment_token: isPaid ? paymentToken : null,
                    api_key: isPaid ? null : apiKey,
                    token_address: address,
                    start_minutes: startMinutes,
                    start_seconds: startSeconds,
                    end_minutes: endMinutes,
                    end_seconds: endSeconds,
                    max_txs: maxTxs
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ğŸ“Š API å›æ‡‰:', data);
                
                if (!data.success) {
                    console.error('âŒ API è¿”å›å¤±æ•—:', data.error);
                    alert('åˆ†æå¤±æ•—: ' + (data.error || 'æœªçŸ¥éŒ¯èª¤'));
                    document.getElementById('loading').classList.remove('active');
                    return;
                }

                // å¦‚æœæ˜¯ä»˜è²»ç”¨æˆ¶ï¼Œæ›´æ–°å‰©é¤˜æ¬¡æ•¸
                if (isPaid && usesLeft !== null) {
                    usesLeft--;
                    localStorage.setItem('uses_left', usesLeft.toString());
                    
                    const usesSpan = document.querySelector('.uses-left');
                    if (usesSpan) {
                        usesSpan.textContent = `${usesLeft} æ¬¡å‰©é¤˜`;
                    }
                    
                    if (usesLeft <= 0) {
                        alert('âœ… åˆ†æå·²é–‹å§‹ï¼\nâš ï¸ é€™æ˜¯æ‚¨æœ€å¾Œä¸€æ¬¡ä½¿ç”¨ä»˜è²»æœå‹™');
                    }
                }

                // æ”¶åˆ° session_idï¼Œé–‹å§‹è¼ªè©¢é€²åº¦
                const sessionId = data.session_id;
                console.log('âœ… æ”¶åˆ° Session ID:', sessionId);
                startProgressPolling(sessionId, address, startTime, endTime);
            })
            .catch(error => {
                console.error('âŒ éŒ¯èª¤:', error);
                alert('ç¶²è·¯éŒ¯èª¤: ' + error.message);
                document.getElementById('loading').classList.remove('active');
            });
        }

        // é€²åº¦è¼ªè©¢
        let progressPollingInterval = null;

        function startProgressPolling(sessionId, tokenAddress, startTime, endTime) {
            console.log('ğŸ”„ é–‹å§‹è¼ªè©¢é€²åº¦:', sessionId);
            
            progressPollingInterval = setInterval(() => {
                fetch(`/api/progress/${sessionId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('ğŸ“Š é€²åº¦:', data);
                        
                        if (!data) {
                            console.error('âŒ ç„¡é€²åº¦æ•¸æ“š');
                            return;
                        }

                        // æ›´æ–°é€²åº¦ UI
                        const progress = data.progress || 0;
                        const stage = data.stage || 'è™•ç†ä¸­';
                        const message = data.message || '';
                        let detail = data.completed && data.total ? 
                            `${data.completed}/${data.total}` : '';
                        
                        // æ·»åŠ é ä¼°æ™‚é–“
                        if (data.total && data.completed && data.completed > 0) {
                            const total = data.total;
                            let estimate = '';
                            
                            if (total < 100) {
                                estimate = 'ç´„ 1 åˆ†é˜';
                            } else if (total < 300) {
                                estimate = 'ç´„ 2-3 åˆ†é˜';
                            } else if (total < 1000) {
                                estimate = 'ç´„ 3-5 åˆ†é˜';
                            } else if (total < 5000) {
                                estimate = 'ç´„ 5-10 åˆ†é˜';
                            } else {
                                estimate = 'ç´„ 10-15 åˆ†é˜';
                            }
                            
                            detail += ` | â±ï¸ ${estimate}`;
                        }
                        
                        updateProgressUI(progress, stage, message, detail);

                        // æª¢æŸ¥æ˜¯å¦å®Œæˆ
                        if (data.status === 'completed') {
                            console.log('âœ… åˆ†æå®Œæˆï¼');
                            console.log('ğŸ“Š å®Œæ•´æ•¸æ“š:', data);
                            console.log('ğŸ“Š data.result:', data.result);
                            console.log('ğŸ“Š data.result é¡å‹:', typeof data.result);
                            console.log('ğŸ“Š data.result.buyers:', data.result && data.result.buyers);
                            console.log('ğŸ“Š data.result.buyers æ˜¯é™£åˆ—?', data.result && Array.isArray(data.result.buyers));
                            
                            stopProgressPolling();
                            
                            // ç²å–çµæœ - æ”¾å¯¬æª¢æŸ¥
                            if (data.result) {
                                console.log('âœ… æœ‰ result ç‰©ä»¶');
                                
                                // æª¢æŸ¥ buyers
                                if (data.result.buyers && Array.isArray(data.result.buyers)) {
                                    console.log(`âœ… æ‰¾åˆ° ${data.result.buyers.length} å€‹è²·å®¶`);
                                    displayAnalysisComplete(data.result, tokenAddress, startTime, endTime);
                                } else {
                                    console.error('âŒ buyers ä¸æ˜¯é™£åˆ—æˆ–ä¸å­˜åœ¨');
                                    console.error('result keys:', Object.keys(data.result));
                                    
                                    // å˜—è©¦å‚™ç”¨æ–¹æ¡ˆ
                                    if (data.result.length > 0) {
                                        console.log('âš ï¸ result æœ¬èº«æ˜¯é™£åˆ—ï¼Œç›´æ¥ä½¿ç”¨');
                                        displayAnalysisComplete({buyers: data.result}, tokenAddress, startTime, endTime);
                                    } else {
                                        alert('åˆ†æå®Œæˆä½†ç„¡è²·å®¶æ•¸æ“š');
                                        document.getElementById('loading').classList.remove('active');
                                    }
                                }
                            } else {
                                console.error('âŒ ç„¡ result ç‰©ä»¶');
                                alert('åˆ†æå®Œæˆä½†ç„¡æ•¸æ“š');
                                document.getElementById('loading').classList.remove('active');
                            }
                        } else if (data.status === 'error') {
                            console.error('âŒ åˆ†æéŒ¯èª¤');
                            stopProgressPolling();
                            alert('åˆ†æéŒ¯èª¤ï¼Œè«‹é‡è©¦');
                            document.getElementById('loading').classList.remove('active');
                        }
                    })
                    .catch(error => {
                        console.error('âŒ è¼ªè©¢éŒ¯èª¤:', error);
                    });
            }, 500);  // æ¯ 500ms è¼ªè©¢ä¸€æ¬¡
        }

        function stopProgressPolling() {
            if (progressPollingInterval) {
                clearInterval(progressPollingInterval);
                progressPollingInterval = null;
                console.log('â¹ï¸ åœæ­¢è¼ªè©¢');
            }
        }

        function displayAnalysisComplete(result, tokenAddress, startTime, endTime) {
            console.log('ğŸ‰ é¡¯ç¤ºçµæœ:', result);
            
            // éš±è— loading
            document.getElementById('loading').classList.remove('active');
            
            // åˆ‡æ›åˆ°çµæœé 
            document.getElementById('heroPage').style.display = 'none';
            document.getElementById('resultsPage').classList.add('active');
            
            // åˆå§‹åŒ–è¡¨é ­èªè¨€
            updateTableHeaders();
            
            // æ›´æ–°è¡¨æ ¼æ¨™é¡Œ
            const tableTitleEl = document.querySelector('.table-header h2');
            if (tableTitleEl) {
                tableTitleEl.textContent = t('tableTitle');
            }
            
            // æ›´æ–°åŒ¯å‡ºæŒ‰éˆ•
            const exportBtn = document.querySelector('.export-btn');
            if (exportBtn) {
                exportBtn.textContent = t('export');
            }

            // å®‰å…¨æª¢æŸ¥
            if (!result || !result.buyers || !Array.isArray(result.buyers)) {
                console.error('âŒ çµæœæ ¼å¼éŒ¯èª¤');
                document.getElementById('tokenInfo').textContent = `Token: ${tokenAddress.substring(0, 10)}...`;
                document.getElementById('totalTx').textContent = '0';
                document.getElementById('maxProfit').textContent = 'Ã—0';
                document.getElementById('robots').textContent = '0';
                document.getElementById('timeRange').textContent = `${startTime}-${endTime}s`;
                
                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 40px;">æ•¸æ“šæ ¼å¼éŒ¯èª¤</td></tr>';
                return;
            }

            // å¡«å……çµ±è¨ˆæ•¸æ“š
            document.getElementById('tokenInfo').textContent = `Token: ${tokenAddress.substring(0, 10)}...`;
            document.getElementById('totalTx').textContent = result.buyers.length || '0';
            
            // Token åç¨±é¡¯ç¤º
            if (result.token_info) {
                const tokenName = result.token_info.name || '';
                const tokenSymbol = result.token_info.symbol || '';
                if (tokenName && tokenSymbol) {
                    document.getElementById('tokenName').textContent = `ğŸ“Š ${tokenName} (${tokenSymbol})`;
                }
            }
            
            // æœ€é«˜åˆ©æ½¤ - å®‰å…¨è¨ˆç®—
            let maxProfit = 0;
            if (result.buyers.length > 0) {
                const profits = result.buyers
                    .map(b => Number(b.profit_multiple) || 0)
                    .filter(p => !isNaN(p) && isFinite(p));
                
                if (profits.length > 0) {
                    maxProfit = Math.max(...profits);
                }
            }
            document.getElementById('maxProfit').textContent = `Ã—${maxProfit.toFixed(1)}`;
            
            // æ©Ÿå™¨äººæ•¸é‡ - ä½¿ç”¨æ­£ç¢ºçš„æ¬„ä½åç¨±
            const robotCount = result.buyers.filter(b => b.is_bot).length;
            document.getElementById('robots').textContent = robotCount;
            
            // æ™‚é–“å€é–“
            document.getElementById('timeRange').textContent = `${startTime}-${endTime}s`;

            // å¡«å……è¡¨æ ¼
            displayResults(result);
        }

        function startFakeProgress() {
            // ç§»é™¤å‡é€²åº¦ï¼Œæ”¹ç”¨çœŸå¯¦é€²åº¦
        }

        function stopFakeProgress() {
            // ç§»é™¤å‡é€²åº¦ï¼Œæ”¹ç”¨çœŸå¯¦é€²åº¦
        }

        function updateProgressUI(progress, stage, message, detail) {
            const progressBar = document.getElementById('progressBarFill');
            const progressPercent = document.getElementById('progressPercent');
            const progressStage = document.getElementById('progressStage');
            const progressMessage = document.getElementById('progressMessage');
            const progressDetail = document.getElementById('progressDetail');
            
            if (progressBar) progressBar.style.width = progress + '%';
            if (progressPercent) progressPercent.textContent = Math.floor(progress) + '%';
            if (progressStage) progressStage.textContent = stage;
            if (progressMessage) progressMessage.textContent = message;
            if (progressDetail && detail) progressDetail.textContent = detail;
        }

        // é¡¯ç¤ºçµæœè¡¨æ ¼
        function displayResults(data) {
            // ä¿å­˜æ•¸æ“šä¾›åŒ¯å‡ºä½¿ç”¨
            currentAnalysisData = data;
            
            const tbody = document.getElementById('tableBody');
            
            if (!data.buyers || data.buyers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ç„¡æ•¸æ“š</td></tr>';
                return;
            }

            tbody.innerHTML = data.buyers.map((buyer, index) => {
                // å®‰å…¨æª¢æŸ¥å’Œæ•¸å€¼è½‰æ› - ä½¿ç”¨æ­£ç¢ºçš„æ¬„ä½
                const bnbProfit = Number(buyer.bnb_profit) || 0;
                const usdProfit = Number(buyer.total_profit_usd) || 0;
                const profit = Number(buyer.profit_multiple) || 0;
                const address = buyer.address || 'æœªçŸ¥';
                const isBot = buyer.is_bot || false;
                const status = buyer.status || 'æœªçŸ¥';
                
                // åˆ¤æ–·é¡¯ç¤ºç‹€æ…‹
                let displayStatus = status;
                let statusClass = '';
                
                if (isBot) {
                    displayStatus = t('bot');
                    statusClass = 'status-bot';
                } else if (status === 'ä»æŒå€‰') {
                    displayStatus = t('holding');
                    statusClass = 'status-holding';
                } else if (status === 'å·²æ¸…å€‰') {
                    displayStatus = t('sold');
                    statusClass = 'status-sold';
                }
                
                return `
                <tr>
                    <td><span class="rank-badge">${index + 1}</span></td>
                    <td class="address-cell" onclick="window.open('https://bscscan.com/address/${address}', '_blank')">
                        ${address.length >= 42 ? address.substring(0, 6) + '...' + address.substring(38) : address}
                    </td>
                    <td>${bnbProfit.toFixed(4)} BNB</td>
                    <td>$${usdProfit.toFixed(2)}</td>
                    <td class="profit-positive">Ã—${profit.toFixed(2)}</td>
                    <td class="${statusClass}">${displayStatus}</td>
                </tr>
                `;
            }).join('');
        }

        // é‡ç½®é€²åº¦
        function resetProgress() {
            fakeProgress = 0;
            updateProgressUI(0, 'åˆå§‹åŒ–...', 'æº–å‚™ä¸­...');
        }

        function backToHome() {
            document.getElementById('resultsPage').classList.remove('active');
            document.getElementById('heroPage').style.display = 'block';
        }

        function copyDonateAddress() {
            const address = '0xe0b7e35556731872B3CE18c9645D69290F428C1C';
            navigator.clipboard.writeText(address).then(() => {
                alert('âœ… æ‰“è³åœ°å€å·²è¤‡è£½ï¼');
            }).catch(() => {
                // å‚™ç”¨æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = address;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('âœ… æ‰“è³åœ°å€å·²è¤‡è£½ï¼');
            });
        }

        // å…¨å±€è®Šæ•¸å­˜å„²ç•¶å‰åˆ†æçµæœ
        let currentAnalysisData = null;
        let sortColumn = null;
        let sortDirection = 'desc';
        let currentLang = localStorage.getItem('lang') || 'zh';

        // ç²å–ç¿»è­¯æ–‡å­— - æ”¾åœ¨æœ€å‰é¢
        function t(key) {
            const translations = {
                zh: {
                    // é¦–é 
                    heroTitle: 'ç™¼ç¾<span class="gradient-text">æ—©é³¥çµæ‰‹</span><br>æ‰¾å‡ºçœŸæ­£çš„ç²åˆ©è´å®¶',
                    heroSubtitle: 'åˆ†æå€å¡Šéˆæ•¸æ“šä¸­çš„æ—©æœŸè²·å®¶è¡Œç‚ºï¼Œ<br>è­˜åˆ¥ç²åˆ©æ©Ÿæœƒä¸¦åµæ¸¬æ©Ÿå™¨äººæ¨¡å¼ã€‚',
                    labelApiKey: 'Etherscan V2 API Key',
                    labelTokenAddress: 'ä»£å¹£åˆç´„åœ°å€',
                    labelStartTime: 'èµ·å§‹æ™‚é–“ï¼ˆé–‹ç›¤å¾Œï¼‰',
                    labelEndTime: 'çµæŸæ™‚é–“ï¼ˆé–‹ç›¤å¾Œï¼‰',
                    labelBotThreshold: 'æ©Ÿå™¨äººé–¾å€¼',
                    tooltipApiKey: 'Etherscan å·²æ”¹ç‚ºä»˜è²» V2 APIï¼Œå…è²»ç‰ˆç„¡æ³•ä½¿ç”¨',
                    tooltipStartTime: 'å¾é–‹ç›¤å¾Œå¤šä¹…é–‹å§‹æŠ“å–<br>ä¾‹ï¼š15åˆ†é˜ = å¾é–‹ç›¤å¾Œ15åˆ†é˜é–‹å§‹',
                    tooltipEndTime: 'åˆ°é–‹ç›¤å¾Œå¤šä¹…çµæŸæŠ“å–<br>ä¾‹ï¼š30åˆ†é˜ = åˆ°é–‹ç›¤å¾Œ30åˆ†é˜ç‚ºæ­¢',
                    tooltipBotThreshold: 'ç¯©é¸é«˜é »äº¤æ˜“å¸³è™Ÿ<br>äº¤æ˜“ç­†æ•¸ > æ­¤å€¼ = æ©Ÿå™¨äºº<br>å»ºè­°ï¼š10ï¼ˆåš´æ ¼ï¼‰~ 100ï¼ˆå¯¬é¬†ï¼‰',
                    unitMinutes: 'åˆ†é˜',
                    unitSeconds: 'ç§’',
                    btnAnalyze: 'ğŸš€ é–‹å§‹åˆ†æ',
                    placeholderApiKey: 'è¼¸å…¥ä½ çš„ Etherscan V2 API Key',
                    
                    // çµæœé 
                    rank: '#',
                    address: 'åœ°å€',
                    bnbProfit: 'BNB åˆ©æ½¤',
                    usdProfit: 'ç¸½åˆ©æ½¤ (USD)',
                    multiple: 'å€æ•¸',
                    status: 'ç‹€æ…‹',
                    bot: 'ğŸ¤– æ©Ÿå™¨äºº',
                    holding: 'âœ“ æŒå€‰ä¸­',
                    sold: 'â— å·²æ¸…å€‰',
                    export: 'ğŸ“¥ åŒ¯å‡º CSV',
                    tableTitle: 'æ—©æœŸè²·å®¶æ’è¡Œæ¦œ',
                    back: 'â† è¿”å›',
                    statTotalTx: 'ç¸½äº¤æ˜“æ•¸',
                    statMaxProfit: 'æœ€é«˜åˆ©æ½¤',
                    statRobots: 'æ©Ÿå™¨äºº',
                    statTimeRange: 'å€é–“',
                    
                    // ä½¿ç”¨èªªæ˜
                    helpBtn: 'èªªæ˜',
                    helpTitle: 'ğŸ“– ä½¿ç”¨èªªæ˜',
                    helpStep1Title: '1ï¸âƒ£ æº–å‚™ API Key',
                    helpStep1Text: 'åœ¨ Etherscan è¨»å†Šä¸¦ç²å– Etherscan V2 API',
                    helpStep2Title: '2ï¸âƒ£ è¼¸å…¥ä»£å¹£åœ°å€',
                    helpStep2Text: 'è²¼ä¸Šè¦åˆ†æçš„ BSC ä»£å¹£åˆç´„åœ°å€<br>ï¼ˆç¾å·²æ”¯æŒ Four.meme & Flapï¼‰',
                    helpStep3Title: '3ï¸âƒ£ è¨­å®šæ™‚é–“å€é–“',
                    helpStep3Text: 'é¸æ“‡å¾é–‹ç›¤å¾Œå¤šä¹…é–‹å§‹/çµæŸåˆ†æ<br>ä¾‹ï¼š0-60ç§’ = åˆ†æé–‹ç›¤å¾Œç¬¬ä¸€åˆ†é˜çš„è²·å®¶',
                    helpStep4Title: '4ï¸âƒ£ è¨­å®šæ©Ÿå™¨äººé–¾å€¼',
                    helpStep4Text: 'äº¤æ˜“ç­†æ•¸è¶…éæ­¤å€¼è¦–ç‚ºæ©Ÿå™¨äºº<br>å»ºè­°ï¼š10ï¼ˆåš´æ ¼ï¼‰~ 100ï¼ˆå¯¬é¬†ï¼‰',
                    helpStep5Title: '5ï¸âƒ£ é–‹å§‹åˆ†æ',
                    helpStep5Text: 'é»æ“ŠæŒ‰éˆ•ï¼Œç­‰å¾… 1-10 åˆ†é˜<br>æŸ¥çœ‹æ—©æœŸè²·å®¶çš„åˆ©æ½¤è¡¨ç¾',
                    helpTipsTitle: 'ğŸ’¡ æç¤º',
                    helpTip1: 'èšç„¦é–‹ç›¤å‰ 1-5 åˆ†é˜æ•ˆæœæœ€å¥½',
                    helpTip2: 'åˆ©æ½¤å€æ•¸é«˜çš„éæ©Ÿå™¨äººå¸³è™Ÿå€¼å¾—é—œæ³¨',
                    helpTip3: 'å¯åŒ¯å‡º CSV é€²è¡Œé€²ä¸€æ­¥åˆ†æ'
                },
                en: {
                    // é¦–é 
                    heroTitle: 'Discover <span class="gradient-text">Early Birds</span><br>Find Real Winners',
                    heroSubtitle: 'Analyze early buyer behavior through blockchain data<br>to identify profit opportunities and detect bot patterns.',
                    labelApiKey: 'Etherscan V2 API Key',
                    labelTokenAddress: 'Token Contract Address',
                    labelStartTime: 'Start Time (After Launch)',
                    labelEndTime: 'End Time (After Launch)',
                    labelBotThreshold: 'Bot Threshold',
                    tooltipApiKey: 'Etherscan now requires paid V2 API, free version unavailable',
                    tooltipStartTime: 'Start tracking after launch<br>e.g., 15 minutes = 15 min after launch',
                    tooltipEndTime: 'Stop tracking after launch<br>e.g., 30 minutes = 30 min after launch',
                    tooltipBotThreshold: 'Filter high-frequency accounts<br>Txs > value = Bot<br>Recommend: 10 (strict) ~ 100 (loose)',
                    unitMinutes: 'min',
                    unitSeconds: 'sec',
                    btnAnalyze: 'ğŸš€ Start Analysis',
                    placeholderApiKey: 'Enter your Etherscan V2 API Key',
                    
                    // çµæœé 
                    rank: '#',
                    address: 'Address',
                    bnbProfit: 'BNB Profit',
                    usdProfit: 'Total Profit (USD)',
                    multiple: 'Multiple',
                    status: 'Status',
                    bot: 'ğŸ¤– Bot',
                    holding: 'âœ“ Holding',
                    sold: 'â— Sold',
                    export: 'ğŸ“¥ Export CSV',
                    tableTitle: 'Early Buyer Leaderboard',
                    back: 'â† Back',
                    statTotalTx: 'Total Tx',
                    statMaxProfit: 'Max Profit',
                    statRobots: 'Bots',
                    statTimeRange: 'Range',
                    
                    // ä½¿ç”¨èªªæ˜
                    helpBtn: 'Guide',
                    helpTitle: 'ğŸ“– User Guide',
                    helpStep1Title: '1ï¸âƒ£ Get API Key',
                    helpStep1Text: 'Register on Etherscan and obtain Etherscan V2 API',
                    helpStep2Title: '2ï¸âƒ£ Enter Token Address',
                    helpStep2Text: 'Paste the BSC token contract address to analyze<br>(Now supports Four.meme & Flap)',
                    helpStep3Title: '3ï¸âƒ£ Set Time Range',
                    helpStep3Text: 'Select start/end time after token launch<br>e.g., 0-60 sec = Analyze first minute buyers',
                    helpStep4Title: '4ï¸âƒ£ Set Bot Threshold',
                    helpStep4Text: 'Transactions > threshold = Marked as bot<br>Recommend: 10 (strict) ~ 100 (loose)',
                    helpStep5Title: '5ï¸âƒ£ Start Analysis',
                    helpStep5Text: 'Click button and wait 1-10 minutes<br>View early buyer profit performance',
                    helpTipsTitle: 'ğŸ’¡ Tips',
                    helpTip1: 'Focus on first 1-5 minutes for best results',
                    helpTip2: 'High-profit non-bot accounts are worth tracking',
                    helpTip3: 'Export CSV for further analysis'
                }
            };
            return translations[currentLang][key] || key;
        }

        // æ›´æ–°è¡¨é ­æ–‡å­—
        function updateTableHeaders() {
            const headers = {
                'th-rank': 'rank',
                'th-address': 'address',
                'th-bnb': 'bnbProfit',
                'th-usd': 'usdProfit',
                'th-multiple': 'multiple',
                'th-status': 'status'
            };
            
            Object.keys(headers).forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const sortIndicator = el.querySelector('.sort-indicator');
                    if (sortIndicator) {
                        // æœ‰æ’åºæŒ‡ç¤ºå™¨çš„æ¬„ä½
                        const indicatorHTML = sortIndicator.outerHTML;
                        el.innerHTML = t(headers[id]) + ' ' + indicatorHTML;
                    } else {
                        // æ²’æœ‰æ’åºæŒ‡ç¤ºå™¨çš„æ¬„ä½
                        el.textContent = t(headers[id]);
                    }
                }
            });
        }

        // åˆ‡æ›ä½¿ç”¨èªªæ˜
        function toggleHelp() {
            const modal = document.getElementById('helpModal');
            modal.classList.toggle('active');
        }
        
        // é»æ“Šå¤–éƒ¨é—œé–‰
        function closeHelpOnOutside(event) {
            if (event.target.id === 'helpModal') {
                toggleHelp();
            }
        }

        // èªè¨€åˆ‡æ›å‡½æ•¸
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('lang', currentLang);
            applyLanguage();
        }
        
        // æ‡‰ç”¨èªè¨€åˆ°æ‰€æœ‰å…ƒç´ 
        function applyLanguage() {
            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            document.getElementById('langText').textContent = currentLang === 'zh' ? 'EN' : 'ä¸­æ–‡';
            
            // é¦–é å…ƒç´ 
            const heroTitle = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            const labelApiKey = document.getElementById('labelApiKey');
            const labelTokenAddress = document.getElementById('labelTokenAddress');
            const labelStartTime = document.getElementById('labelStartTime');
            const labelEndTime = document.getElementById('labelEndTime');
            const labelBotThreshold = document.getElementById('labelBotThreshold');
            const tooltipApiKey = document.getElementById('tooltipApiKey');
            const tooltipStartTime = document.getElementById('tooltipStartTime');
            const tooltipEndTime = document.getElementById('tooltipEndTime');
            const tooltipBotThreshold = document.getElementById('tooltipBotThreshold');
            const btnAnalyze = document.getElementById('btnAnalyze');
            const apiKeyInput = document.getElementById('apiKey');
            
            if (heroTitle) heroTitle.innerHTML = t('heroTitle');
            if (heroSubtitle) heroSubtitle.innerHTML = t('heroSubtitle');
            if (labelApiKey) labelApiKey.textContent = t('labelApiKey');
            if (labelTokenAddress) labelTokenAddress.textContent = t('labelTokenAddress');
            if (labelStartTime) labelStartTime.textContent = t('labelStartTime');
            if (labelEndTime) labelEndTime.textContent = t('labelEndTime');
            if (labelBotThreshold) labelBotThreshold.textContent = t('labelBotThreshold');
            if (tooltipApiKey) tooltipApiKey.innerHTML = t('tooltipApiKey');
            if (tooltipStartTime) tooltipStartTime.innerHTML = t('tooltipStartTime');
            if (tooltipEndTime) tooltipEndTime.innerHTML = t('tooltipEndTime');
            if (tooltipBotThreshold) tooltipBotThreshold.innerHTML = t('tooltipBotThreshold');
            if (btnAnalyze) btnAnalyze.textContent = t('btnAnalyze');
            if (apiKeyInput) apiKeyInput.placeholder = t('placeholderApiKey');
            
            // å–®ä½
            const unitMinutes1 = document.getElementById('unitMinutes1');
            const unitSeconds1 = document.getElementById('unitSeconds1');
            const unitMinutes2 = document.getElementById('unitMinutes2');
            const unitSeconds2 = document.getElementById('unitSeconds2');
            if (unitMinutes1) unitMinutes1.textContent = t('unitMinutes');
            if (unitSeconds1) unitSeconds1.textContent = t('unitSeconds');
            if (unitMinutes2) unitMinutes2.textContent = t('unitMinutes');
            if (unitSeconds2) unitSeconds2.textContent = t('unitSeconds');
            
            // ä½¿ç”¨èªªæ˜æŒ‰éˆ•å’Œå½ˆçª—
            const helpText = document.getElementById('helpText');
            const helpTitle = document.getElementById('helpTitle');
            const helpStep1Title = document.getElementById('helpStep1Title');
            const helpStep1Text = document.getElementById('helpStep1Text');
            const helpStep2Title = document.getElementById('helpStep2Title');
            const helpStep2Text = document.getElementById('helpStep2Text');
            const helpStep3Title = document.getElementById('helpStep3Title');
            const helpStep3Text = document.getElementById('helpStep3Text');
            const helpStep4Title = document.getElementById('helpStep4Title');
            const helpStep4Text = document.getElementById('helpStep4Text');
            const helpStep5Title = document.getElementById('helpStep5Title');
            const helpStep5Text = document.getElementById('helpStep5Text');
            const helpTipsTitle = document.getElementById('helpTipsTitle');
            const helpTip1 = document.getElementById('helpTip1');
            const helpTip2 = document.getElementById('helpTip2');
            const helpTip3 = document.getElementById('helpTip3');
            
            if (helpText) helpText.textContent = t('helpBtn');
            if (helpTitle) helpTitle.textContent = t('helpTitle');
            if (helpStep1Title) helpStep1Title.textContent = t('helpStep1Title');
            if (helpStep1Text) helpStep1Text.innerHTML = t('helpStep1Text');
            if (helpStep2Title) helpStep2Title.textContent = t('helpStep2Title');
            if (helpStep2Text) helpStep2Text.innerHTML = t('helpStep2Text');
            if (helpStep3Title) helpStep3Title.textContent = t('helpStep3Title');
            if (helpStep3Text) helpStep3Text.innerHTML = t('helpStep3Text');
            if (helpStep4Title) helpStep4Title.textContent = t('helpStep4Title');
            if (helpStep4Text) helpStep4Text.innerHTML = t('helpStep4Text');
            if (helpStep5Title) helpStep5Title.textContent = t('helpStep5Title');
            if (helpStep5Text) helpStep5Text.innerHTML = t('helpStep5Text');
            if (helpTipsTitle) helpTipsTitle.textContent = t('helpTipsTitle');
            if (helpTip1) helpTip1.textContent = t('helpTip1');
            if (helpTip2) helpTip2.textContent = t('helpTip2');
            if (helpTip3) helpTip3.textContent = t('helpTip3');
            
            // æª¢æŸ¥æ˜¯å¦åœ¨çµæœé 
            const resultsPage = document.getElementById('resultsPage');
            if (resultsPage && resultsPage.classList.contains('active')) {
                // æ›´æ–°è¡¨é ­
                updateTableHeaders();
                
                // æ›´æ–°è¡¨æ ¼æ¨™é¡Œ
                const tableTitleEl = document.querySelector('.table-header h2');
                if (tableTitleEl) {
                    tableTitleEl.textContent = t('tableTitle');
                }
                
                // æ›´æ–°åŒ¯å‡ºæŒ‰éˆ•
                const exportBtn = document.querySelector('.export-btn');
                if (exportBtn) {
                    exportBtn.textContent = t('export');
                }
                
                // é‡æ–°æ¸²æŸ“è¡¨æ ¼å…§å®¹
                if (currentAnalysisData) {
                    displayResults(currentAnalysisData);
                }
            }
        }

        // é é¢è¼‰å…¥æ™‚è¨­å®šèªè¨€
        window.addEventListener('DOMContentLoaded', () => {
            applyLanguage();
        });


        // æ’åºè¡¨æ ¼
        function sortTable(column) {
            if (!currentAnalysisData || !currentAnalysisData.buyers) return;
            
            // åˆ‡æ›æ’åºæ–¹å‘
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            
            // æ’åºæ•¸æ“š
            const sortedBuyers = [...currentAnalysisData.buyers].sort((a, b) => {
                let aVal, bVal;
                
                switch(column) {
                    case 'address':
                        aVal = a.address || '';
                        bVal = b.address || '';
                        return sortDirection === 'asc' ? 
                            aVal.localeCompare(bVal) : 
                            bVal.localeCompare(aVal);
                    
                    case 'bnb':
                        aVal = Number(a.bnb_profit) || 0;
                        bVal = Number(b.bnb_profit) || 0;
                        break;
                    
                    case 'usd':
                        aVal = Number(a.total_profit_usd) || 0;
                        bVal = Number(b.total_profit_usd) || 0;
                        break;
                    
                    case 'multiple':
                        aVal = Number(a.profit_multiple) || 0;
                        bVal = Number(b.profit_multiple) || 0;
                        break;
                    
                    default:
                        return 0;
                }
                
                return sortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            });
            
            // æ›´æ–°æ’åºæŒ‡ç¤ºå™¨
            document.querySelectorAll('.sort-indicator').forEach(el => {
                el.textContent = '';
                el.classList.remove('active');
            });
            
            const indicator = document.getElementById(`sort-${column}`);
            if (indicator) {
                indicator.textContent = sortDirection === 'asc' ? 'â†‘' : 'â†“';
                indicator.classList.add('active');
            }
            
            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            currentAnalysisData.buyers = sortedBuyers;
            displayResults(currentAnalysisData);
        }

        // åŒ¯å‡º CSV
        function exportCSV() {
            if (!currentAnalysisData || !currentAnalysisData.buyers) {
                alert('æ²’æœ‰å¯åŒ¯å‡ºçš„æ•¸æ“š');
                return;
            }

            // å‘¼å«å¾Œç«¯ API ç”Ÿæˆ CSV
            fetch('/api/export', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(currentAnalysisData)
            })
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `analysis_${Date.now()}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            })
            .catch(error => {
                console.error('åŒ¯å‡ºéŒ¯èª¤:', error);
                alert('åŒ¯å‡ºå¤±æ•—');
            });
        }
    </script>
</body>
</html>
